# 06. ë¬¸ì œí•´ê²° ê°€ì´ë“œ

## ğŸš¨ ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²°ì±…

### 1. API í‚¤ ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "GOOGLE_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
```
ValueError: GOOGLE_API_KEYê°€ .env íŒŒì¼ì— ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
```

**í•´ê²°ì±…:**
```bash
# 1. .env íŒŒì¼ ì¡´ì¬ í™•ì¸
ls -la .env

# 2. .env íŒŒì¼ ìƒì„± ë˜ëŠ” ìˆ˜ì •
cat > .env << EOF
GOOGLE_API_KEY=your_actual_api_key_here
GEMINI_API_KEY=your_actual_api_key_here
ENVIRONMENT=development
EOF

# 3. API í‚¤ í˜•ì‹ í™•ì¸ (AIzaë¡œ ì‹œì‘í•˜ëŠ” 39ì)
echo $GOOGLE_API_KEY | wc -c  # 40ìì—¬ì•¼ í•¨ (ë§ˆì§€ë§‰ ê°œí–‰ í¬í•¨)
```

#### ë¬¸ì œ: "API í‚¤ ê¶Œí•œ ê±°ë¶€"
```
403 Forbidden: Your API key doesn't have permission
```

**í•´ê²°ì±…:**
1. Google Cloud Consoleì—ì„œ Generative AI API í™œì„±í™” í™•ì¸
2. API í‚¤ì˜ ì œí•œ ì‚¬í•­ í™•ì¸
3. ìƒˆë¡œìš´ API í‚¤ ìƒì„±

### 2. ì˜ì¡´ì„± ì„¤ì¹˜ ë¬¸ì œ

#### ë¬¸ì œ: "Python ë²„ì „ í˜¸í™˜ì„± ì˜¤ë¥˜"
```
ERROR: Package requires Python >=3.11.13 but you have 3.10.x
```

**í•´ê²°ì±…:**
```bash
# pyenv ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ë²„ì „ ì„¤ì¹˜
pyenv install 3.11.13
pyenv local 3.11.13
python --version  # Python 3.11.13 í™•ì¸

# ê°€ìƒí™˜ê²½ ì¬ìƒì„±
rm -rf venv
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

#### ë¬¸ì œ: "FAISS ì„¤ì¹˜ ì˜¤ë¥˜"
```
ERROR: Failed building wheel for faiss-cpu
```

**í•´ê²°ì±…:**
```bash
# Windowsì˜ ê²½ìš°
pip install faiss-cpu --no-cache-dir

# Linux/macOSì˜ ê²½ìš°
sudo apt install build-essential  # Ubuntu
brew install llvm  # macOS

# conda ì‚¬ìš© (ê¶Œì¥)
conda install -c conda-forge faiss-cpu
```

### 3. FAISS ì¸ë±ìŠ¤ ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "FAISS ì¸ë±ìŠ¤ íŒŒì¼ ì—†ìŒ"
```
FileNotFoundError: faiss_index_policy.bin not found
```

**í•´ê²°ì±…:**
```python
# ì¸ë±ìŠ¤ ì¬ìƒì„± ìŠ¤í¬ë¦½íŠ¸
from src.core.index_manager import IndexManager

# ì¸ë±ìŠ¤ ë§¤ë‹ˆì € ì´ˆê¸°í™”
index_manager = IndexManager()

# ì¸ë±ìŠ¤ ì¬êµ¬ì¶•
index_manager.rebuild_all_indexes()
print("ì¸ë±ìŠ¤ ì¬êµ¬ì¶• ì™„ë£Œ")
```

#### ë¬¸ì œ: "ì¸ë±ìŠ¤ ì†ìƒ"
```
RuntimeError: Index appears to be corrupted
```

**í•´ê²°ì±…:**
```bash
# ìºì‹œ ë””ë ‰í† ë¦¬ ì •ë¦¬
rm -rf cache/*

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘í•˜ì—¬ ì¸ë±ìŠ¤ ì¬êµ¬ì¶•
python main.py
```

### 4. ì„œë²„ ì‹¤í–‰ ë¬¸ì œ

#### ë¬¸ì œ: "í¬íŠ¸ ì´ë¯¸ ì‚¬ìš© ì¤‘"
```
OSError: [Errno 98] Address already in use
```

**í•´ê²°ì±…:**
```bash
# í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°
netstat -tlnp | grep :8000
# ë˜ëŠ”
lsof -i :8000

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill -9 <PID>

# ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
uvicorn server:app --port 8001
```

#### ë¬¸ì œ: "FastAPI ì„œë²„ ì‹œì‘ ì‹¤íŒ¨"
```
ImportError: No module named 'fastapi'
```

**í•´ê²°ì±…:**
```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™” í™•ì¸
which python
which pip

# ì˜ì¡´ì„± ì¬ì„¤ì¹˜
pip install fastapi uvicorn
# ë˜ëŠ”
pip install -r requirements.txt --force-reinstall
```

### 5. AI ìƒì„± ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "í…œí”Œë¦¿ ìƒì„± ì‹¤íŒ¨"
```
Exception: Template generation failed after 3 retries
```

**í•´ê²°ì±…:**
1. **API í‚¤ í™•ì¸**:
```bash
# API í‚¤ í…ŒìŠ¤íŠ¸
curl -H "x-goog-api-key: $GOOGLE_API_KEY" \
     "https://generativelanguage.googleapis.com/v1/models"
```

2. **ë¡œê·¸ í™•ì¸**:
```python
# ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰
import logging
logging.basicConfig(level=logging.DEBUG)

# ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export PYTHONPATH=.
export LOG_LEVEL=DEBUG
python main.py
```

3. **ì…ë ¥ í…ìŠ¤íŠ¸ ê²€ì¦**:
```python
# ì…ë ¥ ê¸¸ì´ í™•ì¸
user_input = "your_input_text"
if len(user_input) > 1000:
    print("ì…ë ¥ í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤")
    
# íŠ¹ìˆ˜ ë¬¸ì í™•ì¸
import re
if re.search(r'[^\w\sê°€-í£]', user_input):
    print("íŠ¹ìˆ˜ ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤")
```

#### ë¬¸ì œ: "Agent2 ë³‘ë ¬ ì‹¤í–‰ ì˜¤ë¥˜"
```
RuntimeError: Parallel execution failed
```

**í•´ê²°ì±…:**
```python
# src/agents/agent2.py ë””ë²„ê·¸
def debug_parallel_execution(self, user_input):
    """ê° ë„êµ¬ë³„ë¡œ ìˆœì°¨ ì‹¤í–‰í•˜ì—¬ ë¬¸ì œ ì§€ì  íŒŒì•…"""
    
    try:
        blacklist_result = self.blacklist_tool.analyze(user_input)
        print("Blacklist OK")
    except Exception as e:
        print(f"Blacklist ì˜¤ë¥˜: {e}")
    
    try:
        whitelist_result = self.whitelist_tool.analyze(user_input)
        print("Whitelist OK")
    except Exception as e:
        print(f"Whitelist ì˜¤ë¥˜: {e}")
    
    # ê°€ì´ë“œë¼ì¸, ë²•ë ¹ ë„êµ¬ë„ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸
```

### 6. ë©”ëª¨ë¦¬ ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜¤ë¥˜"
```
MemoryError: Unable to allocate array
```

**í•´ê²°ì±…:**
1. **FAISS ì¸ë±ìŠ¤ ìµœì í™”**:
```python
# src/core/index_manager.py
def optimize_index_memory(self):
    """ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ì¸ë±ìŠ¤ ë¡œë”©"""
    
    # ì¸ë±ìŠ¤ë¥¼ í•„ìš”í•  ë•Œë§Œ ë¡œë“œ
    if self.policy_index is None:
        self.policy_index = faiss.read_index(self.policy_index_file)
        
    # ì‚¬ìš© í›„ ë©”ëª¨ë¦¬ í•´ì œ
    def cleanup_index(self):
        if hasattr(self, 'policy_index'):
            del self.policy_index
            self.policy_index = None
```

2. **ë°°ì¹˜ í¬ê¸° ì¡°ì •**:
```python
# ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì‹œ
def process_in_batches(data, batch_size=100):
    for i in range(0, len(data), batch_size):
        batch = data[i:i+batch_size]
        yield batch
```

### 7. ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "Gemini API ì—°ê²° ì‹¤íŒ¨"
```
requests.exceptions.ConnectTimeout: Request timed out
```

**í•´ê²°ì±…:**
```python
# íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ì„¤ì •
import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

def create_robust_session():
    session = requests.Session()
    
    # ì¬ì‹œë„ ì „ëµ
    retry_strategy = Retry(
        total=3,
        backoff_factor=1,
        status_forcelist=[429, 500, 502, 503, 504]
    )
    
    adapter = HTTPAdapter(max_retries=retry_strategy)
    session.mount("http://", adapter)
    session.mount("https://", adapter)
    
    return session
```

### 8. ì¸ì½”ë”© ê´€ë ¨ ë¬¸ì œ

#### ë¬¸ì œ: "í•œê¸€ í…ìŠ¤íŠ¸ ì¸ì½”ë”© ì˜¤ë¥˜"
```
UnicodeDecodeError: 'utf-8' codec can't decode byte
```

**í•´ê²°ì±…:**
```python
# íŒŒì¼ ì½ê¸°ì‹œ ì¸ì½”ë”© ëª…ì‹œ
def read_korean_file(filepath):
    encodings = ['utf-8', 'cp949', 'euc-kr']
    
    for encoding in encodings:
        try:
            with open(filepath, 'r', encoding=encoding) as f:
                return f.read()
        except UnicodeDecodeError:
            continue
    
    raise ValueError(f"íŒŒì¼ {filepath}ì˜ ì¸ì½”ë”©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")

# í™˜ê²½ ë³€ìˆ˜ë¡œ ê°•ì œ ì„¤ì •
import os
os.environ['PYTHONIOENCODING'] = 'utf-8'
```

## ğŸ”§ ë””ë²„ê¹… ë„êµ¬

### 1. ë¡œê·¸ ë¶„ì„
```python
# ìƒì„¸ ë¡œê¹… ì„¤ì •
import logging

def setup_detailed_logging():
    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)s - %(name)s - %(levelname)s - %(funcName)s:%(lineno)d - %(message)s',
        handlers=[
            logging.FileHandler('debug.log', encoding='utf-8'),
            logging.StreamHandler()
        ]
    )

# ê° ëª¨ë“ˆë³„ ë¡œê±° ì„¤ì •
logger = logging.getLogger(__name__)
logger.debug("ë””ë²„ê·¸ ë©”ì‹œì§€")
logger.info("ì •ë³´ ë©”ì‹œì§€")  
logger.warning("ê²½ê³  ë©”ì‹œì§€")
logger.error("ì˜¤ë¥˜ ë©”ì‹œì§€")
```

### 2. ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§
```python
import cProfile
import pstats

def profile_function(func, *args, **kwargs):
    """í•¨ìˆ˜ ì‹¤í–‰ ì„±ëŠ¥ ë¶„ì„"""
    profiler = cProfile.Profile()
    profiler.enable()
    
    result = func(*args, **kwargs)
    
    profiler.disable()
    stats = pstats.Stats(profiler)
    stats.sort_stats('cumulative')
    stats.print_stats(10)  # ìƒìœ„ 10ê°œ ì¶œë ¥
    
    return result

# ì‚¬ìš© ì˜ˆì‹œ
result = profile_function(template_generator.generate_template, "ì¿ í° ë°œê¸‰")
```

### 3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
```python
import psutil
import tracemalloc

def monitor_memory():
    """ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§"""
    process = psutil.Process()
    memory_info = process.memory_info()
    
    print(f"RSS: {memory_info.rss / 1024 / 1024:.2f} MB")
    print(f"VMS: {memory_info.vms / 1024 / 1024:.2f} MB")

def trace_memory_usage():
    """ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¶”ì """
    tracemalloc.start()
    
    # ì½”ë“œ ì‹¤í–‰
    
    current, peak = tracemalloc.get_traced_memory()
    print(f"í˜„ì¬: {current / 1024 / 1024:.2f} MB")
    print(f"ìµœëŒ€: {peak / 1024 / 1024:.2f} MB")
    tracemalloc.stop()
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### 1. ì‘ë‹µ ì‹œê°„ ê°œì„ 
```python
# ìºì‹±ì„ í†µí•œ ì„±ëŠ¥ ê°œì„ 
from functools import lru_cache
import hashlib

class OptimizedAgent2:
    @lru_cache(maxsize=100)
    def cached_validate(self, input_hash: str):
        """ê²€ì¦ ê²°ê³¼ ìºì‹±"""
        return self.parallel_validate(input_hash)
    
    def generate_with_cache(self, user_input: str):
        # ì…ë ¥ í•´ì‹œ ìƒì„±
        input_hash = hashlib.md5(user_input.encode()).hexdigest()
        
        # ìºì‹œëœ ê²°ê³¼ ì‚¬ìš©
        validation_result = self.cached_validate(input_hash)
        return self.generate_template(validation_result)
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
```python
# FAISS ì¸ë±ìŠ¤ ìµœì í™”
def optimize_faiss_search(self, query_vector, k=5):
    """íš¨ìœ¨ì ì¸ ë²¡í„° ê²€ìƒ‰"""
    
    # GPU ì‚¬ìš© ê°€ëŠ¥ì‹œ GPU ì¸ë±ìŠ¤ ì‚¬ìš©
    if hasattr(faiss, 'StandardGpuResources'):
        try:
            res = faiss.StandardGpuResources()
            gpu_index = faiss.index_cpu_to_gpu(res, 0, self.index)
            distances, indices = gpu_index.search(query_vector, k)
        except:
            # GPU ì‹¤íŒ¨ì‹œ CPU í´ë°±
            distances, indices = self.index.search(query_vector, k)
    else:
        distances, indices = self.index.search(query_vector, k)
    
    return distances, indices
```

## ğŸ†˜ ê¸´ê¸‰ ìƒí™© ëŒ€ì‘

### 1. ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì‹œ ë³µêµ¬
```bash
#!/bin/bash
# emergency_recovery.sh

echo "=== ê¸´ê¸‰ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ ==="

# 1. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
systemctl status jober-ai

# 2. ë¡œê·¸ í™•ì¸
tail -50 /var/log/jober-ai/error.log

# 3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart jober-ai

# 4. í—¬ìŠ¤ì²´í¬
sleep 10
if curl -f http://localhost:8000/health; then
    echo "âœ… ì„œë¹„ìŠ¤ ë³µêµ¬ ì™„ë£Œ"
else
    echo "âŒ ì„œë¹„ìŠ¤ ë³µêµ¬ ì‹¤íŒ¨ - ê´€ë¦¬ìì—ê²Œ ì—°ë½"
    # ê´€ë¦¬ì ì•Œë¦¼
    curl -X POST https://hooks.slack.com/your-webhook \
         -H 'Content-type: application/json' \
         --data '{"text":"ğŸš¨ JOBER AI ì„œë¹„ìŠ¤ ë³µêµ¬ ì‹¤íŒ¨"}'
fi
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë³µêµ¬
```bash
# ë°±ì—… ìƒì„±
tar -czf backup_$(date +%Y%m%d_%H%M%S).tar.gz data/ predata/ cache/

# ë°±ì—… ë³µêµ¬
tar -xzf backup_20250904_143000.tar.gz
```

### 3. ë¡¤ë°± ì ˆì°¨
```bash
#!/bin/bash
# rollback.sh

BACKUP_VERSION=$1

if [ -z "$BACKUP_VERSION" ]; then
    echo "ì‚¬ìš©ë²•: ./rollback.sh <version>"
    exit 1
fi

echo "ë²„ì „ $BACKUP_VERSIONìœ¼ë¡œ ë¡¤ë°± ì¤‘..."

# í˜„ì¬ ë²„ì „ ë°±ì—…
git tag "backup-$(date +%Y%m%d-%H%M%S)"

# ì§€ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
git checkout $BACKUP_VERSION

# ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
pip install -r requirements.txt

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart jober-ai

echo "ë¡¤ë°± ì™„ë£Œ"
```

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

### 1. ë¡œê·¸ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸
```bash
#!/bin/bash
# collect_logs.sh

echo "=== ë¡œê·¸ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ==="

# ì‹œìŠ¤í…œ ì •ë³´
echo "=== ì‹œìŠ¤í…œ ì •ë³´ ===" > debug_info.txt
uname -a >> debug_info.txt
python --version >> debug_info.txt
pip freeze >> debug_info.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
echo "=== ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ ===" >> debug_info.txt
tail -100 debug.log >> debug_info.txt

# ì‹œìŠ¤í…œ ë¡œê·¸
echo "=== ì‹œìŠ¤í…œ ë¡œê·¸ ===" >> debug_info.txt  
journalctl -u jober-ai -n 50 >> debug_info.txt

# ì••ì¶•
tar -czf debug_$(date +%Y%m%d_%H%M%S).tar.gz debug_info.txt debug.log

echo "ë¡œê·¸ ìˆ˜ì§‘ ì™„ë£Œ: debug_$(date +%Y%m%d_%H%M%S).tar.gz"
```

### 2. ë¬¸ì œ ë³´ê³  í…œí”Œë¦¿
```markdown
## ë¬¸ì œ ë³´ê³ 

### í™˜ê²½ ì •ë³´
- OS: 
- Python ë²„ì „:
- JOBER AI ë²„ì „:

### ë¬¸ì œ ì„¤ëª…
[ë¬¸ì œì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…]

### ì¬í˜„ ë‹¨ê³„
1. 
2. 
3. 

### ê¸°ëŒ€ ê²°ê³¼
[ì˜ˆìƒí–ˆë˜ ê²°ê³¼]

### ì‹¤ì œ ê²°ê³¼
[ì‹¤ì œ ë°œìƒí•œ ê²°ê³¼]

### ì˜¤ë¥˜ ë©”ì‹œì§€
```
[ì˜¤ë¥˜ ë©”ì‹œì§€ ì „ë¬¸]
```

### ì¶”ê°€ ì •ë³´
[ìŠ¤í¬ë¦°ìƒ·, ë¡œê·¸ íŒŒì¼ ë“±]
```

---

**ì—°ë½ì²˜:**
- ğŸ“§ ì´ë©”ì¼: support@jober.ai  
- ğŸ› ì´ìŠˆ íŠ¸ë˜ì»¤: [GitHub Issues](https://github.com/your-username/Jober_ai/issues)
- ğŸ“š ë¬¸ì„œ: [ìƒì„¸ ë¬¸ì„œ](./README.md)

---

**ì´ì „ ë¬¸ì„œ**: [05_ë°°í¬_ê°€ì´ë“œ.md](./05_ë°°í¬_ê°€ì´ë“œ.md)