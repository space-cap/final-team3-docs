# 03. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ê°œìš”

JOBER AIëŠ” **Agent-Based AI Architecture**ë¥¼ ì±„íƒí•˜ì—¬ ë†’ì€ í™•ì¥ì„±ê³¼ ëª¨ë“ˆì„±ì„ ì œê³µí•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        JOBER AI System                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPI Server (server.py)                                â”‚
â”‚  â”œâ”€â”€ POST /ai/templates                                     â”‚  
â”‚  â””â”€â”€ GET /health                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Layer (api.py)                                         â”‚
â”‚  â”œâ”€â”€ TemplateAPI Class                                      â”‚
â”‚  â”œâ”€â”€ JSON Export                                            â”‚
â”‚  â””â”€â”€ Health Check                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Core Engine (src/core/)                                    â”‚
â”‚  â”œâ”€â”€ TemplateGenerator                                      â”‚
â”‚  â”œâ”€â”€ IndexManager (FAISS)                                   â”‚
â”‚  â””â”€â”€ EntityExtractor                                        â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent System (src/agents/)                                 â”‚
â”‚  â””â”€â”€ Agent2 (4-Tool Parallel Validation)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Specialized Tools (src/tools/)                             â”‚
â”‚  â”œâ”€â”€ BlacklistTool     â”œâ”€â”€ WhitelistTool                   â”‚
â”‚  â”œâ”€â”€ InfoCommLawTool   â”œâ”€â”€ GuidelineTool                   â”‚
â”‚  â”œâ”€â”€ DatePreprocessor  â”œâ”€â”€ IntentClassifier                â”‚
â”‚  â””â”€â”€ VariableExtractor                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Layer                                                  â”‚
â”‚  â”œâ”€â”€ data/ (ì›ë³¸ ê°€ì´ë“œë¼ì¸)                                â”‚
â”‚  â”œâ”€â”€ predata/ (ì „ì²˜ë¦¬ëœ ë°ì´í„°)                             â”‚
â”‚  â””â”€â”€ cache/ (FAISS ì¸ë±ìŠ¤)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¤– Agent2 ì•„í‚¤í…ì²˜

**Agent2**ëŠ” ì‹œìŠ¤í…œì˜ í•µì‹¬ AI ì—”ì§„ìœ¼ë¡œ, 4ê°œì˜ ì „ë¬¸í™”ëœ ë„êµ¬ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

### 4-Tool Parallel Validation System

```
User Input: "ì¿ í° ë°œê¸‰ ì•ˆë‚´"
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Agent2 Core   â”‚
    â”‚   (Orchestrator)â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Parallel Executionâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                           â”‚
    â–¼         â–¼         â–¼           â–¼           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚Blacklistâ”‚ â”‚Whitelist â”‚ â”‚Guideline â”‚ â”‚InfoCommâ”‚â”‚
â”‚  Tool   â”‚ â”‚   Tool   â”‚ â”‚   Tool   â”‚ â”‚LawTool â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚         â”‚           â”‚           â”‚         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Validation Resultsâ”‚
    â”‚ + Context Data   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Template Generationâ”‚
    â”‚ (Gemini 2.5 Flash) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent2 í•µì‹¬ ì»´í¬ë„ŒíŠ¸

#### 1. ë³‘ë ¬ ë„êµ¬ ì‹¤í–‰ê¸° (Parallel Tool Executor)
```python
# src/agents/agent2.py
class Agent2:
    def __init__(self):
        self.tools = {
            "blacklist": BlacklistTool(),
            "whitelist": WhitelistTool(), 
            "guideline": GuidelineTool(),
            "law": InfoCommLawTool()
        }
        
    def parallel_validate(self, user_input):
        # RunnableParallelì„ ì‚¬ìš©í•œ ë³‘ë ¬ ì‹¤í–‰
        parallel_results = self.runnable_parallel.invoke({
            "input": user_input
        })
        return self._merge_results(parallel_results)
```

#### 2. ì»¨í…ìŠ¤íŠ¸ í†µí•©ê¸° (Context Integrator)
- 4ê°œ ë„êµ¬ì˜ ê²°ê³¼ë¥¼ í•˜ë‚˜ì˜ ì»¨í…ìŠ¤íŠ¸ë¡œ í†µí•©
- ì •ì±… ì¤€ìˆ˜ ì—¬ë¶€ íŒë‹¨
- ìµœì ì˜ í…œí”Œë¦¿ ìƒì„±ì„ ìœ„í•œ ê°€ì´ë“œë¼ì¸ ì œê³µ

#### 3. í…œí”Œë¦¿ ìƒì„±ê¸° (Template Generator)
- Gemini 2.5 Flashì™€ ì—°ë™
- í†µí•©ëœ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ í…œí”Œë¦¿ ìƒì„±
- ë³€ìˆ˜ ì¶”ì¶œ ë° í¬ë§·íŒ…

## ğŸ” FAISS ë²¡í„° ê²€ìƒ‰ ì‹œìŠ¤í…œ

### ì¸ë±ìŠ¤ êµ¬ì¡°
```
cache/
â”œâ”€â”€ faiss_index_policy.bin          # ì •ì±… ë¬¸ì„œ ì¸ë±ìŠ¤
â”œâ”€â”€ faiss_index_examples.bin        # ì˜ˆì‹œ í…œí”Œë¦¿ ì¸ë±ìŠ¤  
â”œâ”€â”€ faiss_index_validation.bin      # ê²€ì¦ ë°ì´í„° ì¸ë±ìŠ¤
â”œâ”€â”€ document_chunks_policy.pkl      # ì •ì±… ë¬¸ì„œ ì²­í¬
â”œâ”€â”€ document_chunks_examples.pkl    # ì˜ˆì‹œ í…œí”Œë¦¿ ì²­í¬
â””â”€â”€ document_chunks_validation.pkl  # ê²€ì¦ ë°ì´í„° ì²­í¬
```

### ë²¡í„° ê²€ìƒ‰ í”„ë¡œì„¸ìŠ¤
1. **ì„ë² ë”© ìƒì„±**: Google Embedding-001 ëª¨ë¸ ì‚¬ìš©
2. **ìœ ì‚¬ë„ ê²€ìƒ‰**: FAISS L2 ê±°ë¦¬ ê¸°ë°˜ ê²€ìƒ‰
3. **ì»¨í…ìŠ¤íŠ¸ ì„ íƒ**: Top-K ìœ ì‚¬ ë¬¸ì„œ ì„ íƒ (ê¸°ë³¸ê°’: K=5)
4. **ì»¨í…ìŠ¤íŠ¸ í†µí•©**: ì„ íƒëœ ë¬¸ì„œë“¤ì„ í•˜ë‚˜ì˜ ì»¨í…ìŠ¤íŠ¸ë¡œ ê²°í•©

### ì„±ëŠ¥ ìµœì í™”
- **ìºì‹±**: ì¸ë±ìŠ¤ ë©”ëª¨ë¦¬ ìºì‹±ìœ¼ë¡œ ë¹ ë¥¸ ê²€ìƒ‰
- **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ ì¿¼ë¦¬ ë™ì‹œ ì²˜ë¦¬ ì§€ì›
- **ì••ì¶•**: FAISS IndexIVF ì••ì¶• ì¸ë±ìŠ¤ ì‚¬ìš©

## ğŸ› ï¸ Core ëª¨ë“ˆ ì•„í‚¤í…ì²˜

### 1. TemplateGenerator (`src/core/template_generator.py`)
```python
class TemplateGenerator(BaseTemplateProcessor):
    def __init__(self):
        self.agent2 = Agent2()
        self.index_manager = IndexManager()
        
    def generate_template(self, user_input):
        # 1. ë‚ ì§œ ì „ì²˜ë¦¬
        processed_input = self.preprocess_dates(user_input)
        
        # 2. Agent2 ë³‘ë ¬ ê²€ì¦
        validation_results = self.agent2.parallel_validate(processed_input)
        
        # 3. ë²¡í„° ê²€ìƒ‰
        context = self.index_manager.similarity_search(processed_input)
        
        # 4. í…œí”Œë¦¿ ìƒì„±
        return self.generate_with_context(validation_results, context)
```

### 2. IndexManager (`src/core/index_manager.py`)
- FAISS ì¸ë±ìŠ¤ ë¡œë”©/ì €ì¥
- ë²¡í„° ì„ë² ë”© ìƒì„±
- ìœ ì‚¬ë„ ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤
- ìºì‹œ ê´€ë¦¬

### 3. EntityExtractor (`src/core/entity_extractor.py`)
- ë³€ìˆ˜ ì¶”ì¶œ (#{ë³€ìˆ˜ëª…} íŒ¨í„´)
- ì—”í‹°í‹° ë¶„ë¥˜ (ë‚ ì§œ, ì´ë¦„, ê¸ˆì•¡ ë“±)
- 6W ë¶„ì„ (Who, What, When, Where, Why, hoW)

## ğŸ”§ ë„êµ¬ ì‹œìŠ¤í…œ (Tools)

### ì •ì±… ê²€ì¦ ë„êµ¬
1. **BlacklistTool**: ê¸ˆì§€ í‚¤ì›Œë“œ ê²€ì‚¬
2. **WhitelistTool**: í—ˆìš© íŒ¨í„´ ê²€ì¦  
3. **InfoCommLawTool**: ì •ë³´í†µì‹ ë²• ì¤€ìˆ˜ ê²€ì‚¬
4. **GuidelineTool**: ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ê°€ì´ë“œë¼ì¸ ê²€ì¦

### ì „ì²˜ë¦¬ ë„êµ¬
1. **DatePreprocessor**: ìì—°ì–´ ë‚ ì§œ â†’ ì‹¤ì œ ë‚ ì§œ ë³€í™˜
2. **IntentClassifier**: ì‚¬ìš©ì ì˜ë„ ë¶„ë¥˜
3. **VariableExtractor**: ë™ì  ë³€ìˆ˜ ì¶”ì¶œ

### ë„êµ¬ í†µí•© ì¸í„°í˜ì´ìŠ¤
```python
# src/tools/__init__.py
from .blacklist_tool import BlacklistTool
from .whitelist_tool import WhitelistTool
from .info_comm_law_tool import InfoCommLawTool
from .date_preprocessor import DatePreprocessor

__all__ = [
    'BlacklistTool',
    'WhitelistTool', 
    'InfoCommLawTool',
    'DatePreprocessor'
]
```

## ğŸŒ API ê³„ì¸µ ì•„í‚¤í…ì²˜

### FastAPI ì„œë²„ êµ¬ì¡° (`server.py`)
```python
app = FastAPI()
template_api = get_template_api()  # api.py ì‹±ê¸€í†¤

@app.post("/ai/templates")
async def create_template(request: TemplateCreationRequest):
    # 1. ìš”ì²­ ê²€ì¦
    # 2. í…œí”Œë¦¿ ìƒì„± (api.py ìœ„ì„)
    # 3. JSON ë³€í™˜
    # 4. ì‘ë‹µ ë°˜í™˜
```

### API ìœ í‹¸ë¦¬í‹° (`api.py`)
```python
class TemplateAPI:
    def __init__(self):
        self.template_generator = TemplateGenerator()
        
    def generate_template(self, user_input):
        # í•µì‹¬ ìƒì„± ë¡œì§
        
    def export_to_json(self, result, user_input, user_id):
        # ê¸°ì—… DB ìŠ¤í‚¤ë§ˆ ë§¤í•‘
```

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

### 1. ìš”ì²­ ì²˜ë¦¬ í”Œë¡œìš°
```
HTTP Request â†’ FastAPI â†’ API Layer â†’ Core Engine â†’ Agent2 â†’ Tools â†’ Response
     â†“            â†“          â†“           â†“          â†“       â†“        â†“
   JSON Input  Request   Template    Agent2    4-Tool   Results   JSON Output
              Validation Generator  Orchestrator Parallel          
```

### 2. ë°ì´í„° ë³€í™˜ í”Œë¡œìš°
```
User Input â†’ Date Processing â†’ Intent Classification â†’ Context Search â†’ Template Generation
    â†“              â†“                   â†“                    â†“              â†“
"ë‹¤ìŒ ì£¼ í™”ìš”ì¼"  "2025-09-09"      "êµìœ¡/ì¼ì •"        Vector Search    Final Template
```

## ğŸ”„ í™•ì¥ì„± ì„¤ê³„

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì¤€ë¹„
- **ë…ë¦½ì  ì»´í¬ë„ŒíŠ¸**: ê° ëª¨ë“ˆì´ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘
- **API ê¸°ë°˜ í†µì‹ **: RESTful APIë¡œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- **ìƒíƒœ ë¹„ì €ì¥**: ì„¸ì…˜ ì •ë³´ ì—†ëŠ” ë¬´ìƒíƒœ ì„¤ê³„

### ìˆ˜í‰ í™•ì¥ ì§€ì›
- **Load Balancing**: FastAPI + Uvicorn ë©€í‹° ì›Œì»¤
- **ìºì‹œ ì™¸ë¶€í™”**: Redis/Memcached ì—°ë™ ì¤€ë¹„
- **DB ë¶„ë¦¬**: ë©”íƒ€ë°ì´í„°/ë²¡í„°DB ë¶„ë¦¬ ê°€ëŠ¥

### í”ŒëŸ¬ê·¸ì¸ ì•„í‚¤í…ì²˜
- **ë„êµ¬ í™•ì¥**: ìƒˆë¡œìš´ ê²€ì¦ ë„êµ¬ ì¶”ê°€ ìš©ì´
- **ëª¨ë¸ êµì²´**: AI ëª¨ë¸ êµì²´ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- **ì»¤ìŠ¤í…€ ë¶„ë¥˜ê¸°**: ì—…ì¢…ë³„ ë¶„ë¥˜ê¸° ì¶”ê°€ ì§€ì›

## ğŸ“ˆ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í¬ì¸íŠ¸
- API ì‘ë‹µ ì‹œê°„
- Agent2 ì‹¤í–‰ ì‹œê°„
- FAISS ê²€ìƒ‰ ì‹œê°„
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
- í…œí”Œë¦¿ ìƒì„± ì„±ê³µë¥ 

### ë¡œê¹… êµ¬ì¡°
```python
import logging

# êµ¬ì¡°í™”ëœ ë¡œê¹…
logger = logging.getLogger("jober_ai")
logger.info("Template generated", extra={
    "user_id": user_id,
    "category_id": category_id,
    "generation_time": elapsed_time,
    "success": True
})
```

---

**ì´ì „ ë¬¸ì„œ**: [02_API_ì‚¬ìš©ë²•.md](./02_API_ì‚¬ìš©ë²•.md)  
**ë‹¤ìŒ ë¬¸ì„œ**: [04_ê°œë°œ_ê°€ì´ë“œ.md](./04_ê°œë°œ_ê°€ì´ë“œ.md)