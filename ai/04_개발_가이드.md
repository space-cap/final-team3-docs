# 04. ê°œë°œ ê°€ì´ë“œ

## ğŸš€ ê°œë°œ í™˜ê²½ ì„¤ì •

### 1. ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
- **Python**: 3.11.13 (ì •í™•í•œ ë²„ì „ í•„ìˆ˜)
- **OS**: Windows 10/11, macOS 10.15+, Ubuntu 18.04+
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 8GB RAM (ê¶Œì¥ 16GB)
- **ì €ì¥ê³µê°„**: ìµœì†Œ 2GB ì—¬ìœ ê³µê°„

### 2. í™˜ê²½ ì„¤ì •

#### ìë™ ì„¤ì¹˜ (ê¶Œì¥)
```bash
# ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
git clone https://github.com/your-username/Jober_ai.git
cd Jober_ai

# pyenvë¥¼ ì‚¬ìš©í•œ Python ë²„ì „ ê´€ë¦¬
pyenv install 3.11.13
pyenv local 3.11.13

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

#### Poetry ì‚¬ìš© (ê¶Œì¥)
```bash
# Poetry ì„¤ì¹˜
curl -sSL https://install.python-poetry.org | python3 -

# í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
poetry install

# ê°œë°œ ë„êµ¬ í¬í•¨ ì„¤ì¹˜
poetry install --with dev,docs

# ê°€ìƒí™˜ê²½ í™œì„±í™”
poetry shell
```

### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# .env íŒŒì¼ ìƒì„±
cat > .env << EOF
GOOGLE_API_KEY=your_gemini_api_key_here
GEMINI_API_KEY=your_gemini_api_key_here
ENVIRONMENT=development
EOF
```

## ğŸ› ï¸ ê°œë°œ ë„êµ¬ ì„¤ì •

### 1. ì½”ë“œ í¬ë§·íŒ…
```bash
# Black í¬ë§·í„°
black src/ tests/ --line-length 88 --target-version py311

# import ì •ë ¬
isort src/ tests/ --profile black
```

### 2. ì •ì  ë¶„ì„
```bash
# íƒ€ì… ì²´í‚¹
mypy src/ --python-version 3.11

# ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬  
flake8 src/ --max-line-length=88
```

### 3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
pytest

# ì»¤ë²„ë¦¬ì§€ í¬í•¨
pytest --cov=src --cov-report=term-missing --cov-report=html

# íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼
pytest test_backend_integration.py -v
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

### ë””ë ‰í† ë¦¬ êµ¬ì„±
```
Jober_ai/
â”œâ”€â”€ src/                    # ë©”ì¸ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agents/             # AI ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ agent1.py       # (ë¯¸ì‚¬ìš©)
â”‚   â”‚   â””â”€â”€ agent2.py       # ë©”ì¸ ìƒì„± ì—ì´ì „íŠ¸
â”‚   â”œâ”€â”€ core/               # í•µì‹¬ ì—”ì§„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_processor.py
â”‚   â”‚   â”œâ”€â”€ template_generator.py
â”‚   â”‚   â”œâ”€â”€ index_manager.py
â”‚   â”‚   â””â”€â”€ entity_extractor.py
â”‚   â”œâ”€â”€ tools/              # ì „ë¬¸í™”ëœ ë„êµ¬
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ blacklist_tool.py
â”‚   â”‚   â”œâ”€â”€ whitelist_tool.py
â”‚   â”‚   â”œâ”€â”€ info_comm_law_tool.py
â”‚   â”‚   â”œâ”€â”€ date_preprocessor.py
â”‚   â”‚   â”œâ”€â”€ intent_classifier.py
â”‚   â”‚   â””â”€â”€ variable_extractor.py
â”‚   â””â”€â”€ utils/              # ìœ í‹¸ë¦¬í‹°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ common_init.py
â”‚       â”œâ”€â”€ data_processor.py
â”‚       â””â”€â”€ sample_templates.py
â”œâ”€â”€ data/                   # ì›ë³¸ ê°€ì´ë“œë¼ì¸
â”œâ”€â”€ predata/               # ì „ì²˜ë¦¬ëœ ë°ì´í„°
â”œâ”€â”€ cache/                 # FAISS ì¸ë±ìŠ¤
â”œâ”€â”€ docs/                  # ë¬¸ì„œ
â”œâ”€â”€ tests/                 # í…ŒìŠ¤íŠ¸ (ì˜ˆì •)
â”œâ”€â”€ main.py               # CLI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ server.py             # FastAPI ì„œë²„
â”œâ”€â”€ api.py                # API ë¡œì§
â”œâ”€â”€ config.py             # ì„¤ì •
â””â”€â”€ requirements.txt      # ì˜ì¡´ì„±
```

### ëª¨ë“ˆ ì„í¬íŠ¸ ê·œì¹™
```python
# ì ˆëŒ€ ê²½ë¡œ ì„í¬íŠ¸ ì‚¬ìš©
from src.core.template_generator import TemplateGenerator
from src.agents.agent2 import Agent2
from src.tools.date_preprocessor import DatePreprocessor

# ìƒëŒ€ ê²½ë¡œ ì„í¬íŠ¸ (ê°™ì€ íŒ¨í‚¤ì§€ ë‚´ì—ì„œë§Œ)
from .base_processor import BaseTemplateProcessor
from ..tools.blacklist_tool import BlacklistTool
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ê°œë°œ

### 1. ìƒˆë¡œìš´ ë„êµ¬(Tool) ì¶”ê°€

#### ë„êµ¬ ê¸°ë³¸ êµ¬ì¡°
```python
# src/tools/custom_tool.py
import os
import sys

# ìƒìœ„ ë””ë ‰í† ë¦¬ ì ‘ê·¼ì„ ìœ„í•œ path ì¶”ê°€
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
from config import GEMINI_API_KEY

class CustomTool:
    """ìƒˆë¡œìš´ ê²€ì¦ ë„êµ¬ í…œí”Œë¦¿"""
    
    def __init__(self, api_key: str = None):
        self.api_key = api_key or GEMINI_API_KEY
        self.predata_cache = None
        
    def load_data(self):
        """ë°ì´í„° ë¡œë”© ë¡œì§"""
        if self.predata_cache is None:
            # ë°ì´í„° ë¡œë”© êµ¬í˜„
            pass
        return self.predata_cache
    
    def analyze(self, user_input: str, context: str = "") -> dict:
        """ë¶„ì„ ë¡œì§ êµ¬í˜„"""
        return {
            "status": "success",
            "data": "ë¶„ì„ ê²°ê³¼",
            "confidence": 0.95
        }
```

#### Agent2ì— ë„êµ¬ ì¶”ê°€
```python
# src/agents/agent2.py ìˆ˜ì •
def __init__(self):
    # ê¸°ì¡´ ë„êµ¬ë“¤
    self.blacklist_tool = self._init_blacklist_tool()
    self.whitelist_tool = self._init_whitelist_tool() 
    self.guideline_tool = self._init_guideline_tool()
    self.law_tool = self._init_law_tool()
    
    # ìƒˆë¡œìš´ ë„êµ¬ ì¶”ê°€
    self.custom_tool = self._init_custom_tool()
    
    self.tools = {
        "blacklist": self.blacklist_tool,
        "whitelist": self.whitelist_tool,
        "guideline": self.guideline_tool,
        "law": self.law_tool,
        "custom": self.custom_tool  # ì¶”ê°€
    }

def _init_custom_tool(self):
    from ..tools.custom_tool import CustomTool
    return CustomTool(api_key=self.api_key)
```

### 2. ìƒˆë¡œìš´ ì—…ì¢… ì¹´í…Œê³ ë¦¬ ì¶”ê°€

#### ì¹´í…Œê³ ë¦¬ ì •ì˜
```python
# src/utils/category_mapping.py (ì‹ ê·œ ìƒì„±)
CATEGORY_MAPPING = {
    "ì†Œë§¤ì—…": 9101,
    "ë¶€ë™ì‚°": 9102, 
    "êµìœ¡": 9103,
    "ì„œë¹„ìŠ¤ì—…": 9104,
    "ê¸°íƒ€": 9105,
    "ì˜ë£Œ": 9106,  # ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
    "ê¸ˆìœµ": 9107   # ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
}

CATEGORY_KEYWORDS = {
    9106: ["ë³‘ì›", "ì˜ë£Œ", "ì§„ë£Œ", "ì²˜ë°©", "ê±´ê°•ê²€ì§„", "ì˜ˆì•½"],
    9107: ["ëŒ€ì¶œ", "íˆ¬ì", "ë³´í—˜", "ì¹´ë“œ", "ê¸ˆìœµ", "ì ê¸ˆ"]
}
```

#### ë¶„ë¥˜ ë¡œì§ ìˆ˜ì •
```python  
# src/core/template_generator.py
def classify_category(self, user_input: str) -> int:
    """ì—…ì¢… ìë™ ë¶„ë¥˜"""
    from ..utils.category_mapping import CATEGORY_KEYWORDS
    
    for category_id, keywords in CATEGORY_KEYWORDS.items():
        if any(keyword in user_input for keyword in keywords):
            return category_id
    return 9105  # ê¸°íƒ€
```

### 3. API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€

#### ìƒˆ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
```python
# server.pyì— ì¶”ê°€
@app.get("/ai/categories")
async def get_categories():
    """ì§€ì›í•˜ëŠ” ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë°˜í™˜"""
    from src.utils.category_mapping import CATEGORY_MAPPING
    return {
        "categories": [
            {"id": cat_id, "name": cat_name} 
            for cat_name, cat_id in CATEGORY_MAPPING.items()
        ]
    }

@app.post("/ai/analyze")  
async def analyze_input(request: AnalysisRequest):
    """ì…ë ¥ í…ìŠ¤íŠ¸ ë¶„ì„ (í…œí”Œë¦¿ ìƒì„± ì „ ë‹¨ê³„)"""
    try:
        analysis = template_api.analyze_input(request.content)
        return {
            "predicted_category": analysis["category"],
            "extracted_variables": analysis["variables"],
            "confidence": analysis["confidence"]
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‘ì„±

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
# tests/test_agent2.py (ì‹ ê·œ ìƒì„±)
import pytest
from src.agents.agent2 import Agent2

class TestAgent2:
    @pytest.fixture
    def agent2(self):
        return Agent2()
    
    def test_parallel_validation(self, agent2):
        """4-ë„êµ¬ ë³‘ë ¬ ê²€ì¦ í…ŒìŠ¤íŠ¸"""
        user_input = "ì¿ í° ë°œê¸‰ ì•ˆë‚´"
        result = agent2.parallel_validate(user_input)
        
        assert result["status"] == "success"
        assert "blacklist" in result["validation_results"]
        assert "whitelist" in result["validation_results"]
        assert "guideline" in result["validation_results"]
        assert "law" in result["validation_results"]
    
    def test_template_generation(self, agent2):
        """í…œí”Œë¦¿ ìƒì„± í…ŒìŠ¤íŠ¸"""
        user_input = "ì¿ í° ë°œê¸‰ ì•ˆë‚´"
        result = agent2.generate_template(user_input)
        
        assert "generated_template" in result
        assert "#{" in result["generated_template"]  # ë³€ìˆ˜ í¬í•¨ í™•ì¸
        assert len(result["generated_template"]) > 50  # ìµœì†Œ ê¸¸ì´ ê²€ì¦
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸
```python
# tests/test_integration.py (ì‹ ê·œ ìƒì„±)
import pytest
from api import get_template_api

class TestIntegration:
    @pytest.fixture
    def template_api(self):
        return get_template_api()
    
    @pytest.mark.asyncio
    async def test_end_to_end_flow(self, template_api):
        """ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""
        user_input = "ë¶€ë™ì‚° ìƒë‹´ ì˜ˆì•½"
        
        # 1. í…œí”Œë¦¿ ìƒì„±
        result = template_api.generate_template(user_input)
        assert result["success"] is True
        
        # 2. JSON ë³€í™˜
        json_result = template_api.export_to_json(
            result, user_input, user_id=101
        )
        assert json_result["success"] is True
        assert json_result["data"]["template"]["category_id"] == 9102
```

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
```python
# tests/test_performance.py (ì‹ ê·œ ìƒì„±)
import time
import pytest
from src.core.template_generator import TemplateGenerator

class TestPerformance:
    def test_generation_speed(self):
        """í…œí”Œë¦¿ ìƒì„± ì†ë„ í…ŒìŠ¤íŠ¸"""
        generator = TemplateGenerator(api_key="test_key")
        
        start_time = time.time()
        result = generator.generate_template("ì¿ í° ë°œê¸‰ ì•ˆë‚´")
        elapsed_time = time.time() - start_time
        
        # 5ì´ˆ ì´ë‚´ ìƒì„± ì™„ë£Œ ê¸°ëŒ€
        assert elapsed_time < 5.0
        assert result is not None
```

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### 1. ë¡œê¹… ì„¤ì •
```python
# config.pyì— ì¶”ê°€
import logging

# ê°œë°œ í™˜ê²½ì—ì„œ ìƒì„¸ ë¡œê¹…
if os.getenv("ENVIRONMENT") == "development":
    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
else:
    logging.basicConfig(level=logging.INFO)

logger = logging.getLogger("jober_ai")
```

### 2. ë‹¨ê³„ë³„ ë””ë²„ê¹…
```python
# src/agents/agent2.py
def generate_template(self, user_input: str):
    logger.debug(f"Input received: {user_input}")
    
    # 1. ë³‘ë ¬ ê²€ì¦
    validation_start = time.time()
    validation_results = self.parallel_validate(user_input)
    logger.debug(f"Validation completed in {time.time() - validation_start:.2f}s")
    
    # 2. ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰
    context_start = time.time()
    context = self.search_context(user_input)
    logger.debug(f"Context search completed in {time.time() - context_start:.2f}s")
    
    # 3. í…œí”Œë¦¿ ìƒì„±
    generation_start = time.time()
    template = self.generate_with_context(validation_results, context)
    logger.debug(f"Template generated in {time.time() - generation_start:.2f}s")
    
    return template
```

### 3. ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
```python
# í‘œì¤€ ì—ëŸ¬ ì²˜ë¦¬
try:
    result = dangerous_operation()
except SpecificException as e:
    logger.error(f"Expected error occurred: {e}")
    return {"error": str(e), "success": False}
except Exception as e:
    logger.exception("Unexpected error occurred")
    return {"error": "Internal server error", "success": False}
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### 1. ìºì‹± ì „ëµ
```python
# ë©”ëª¨ë¦¬ ìºì‹±
from functools import lru_cache

class Agent2:
    @lru_cache(maxsize=128)
    def get_cached_validation(self, user_input_hash: str):
        """ê²€ì¦ ê²°ê³¼ ìºì‹±"""
        return self.parallel_validate(user_input_hash)
```

### 2. ë¹„ë™ê¸° ì²˜ë¦¬
```python
# async/await íŒ¨í„´ í™œìš©
import asyncio

async def parallel_tool_execution(self, user_input):
    """ë„êµ¬ë“¤ì„ ë¹„ë™ê¸°ë¡œ ë³‘ë ¬ ì‹¤í–‰"""
    tasks = [
        self.blacklist_tool.analyze_async(user_input),
        self.whitelist_tool.analyze_async(user_input),
        self.guideline_tool.analyze_async(user_input),
        self.law_tool.analyze_async(user_input)
    ]
    results = await asyncio.gather(*tasks)
    return dict(zip(["blacklist", "whitelist", "guideline", "law"], results))
```

### 3. ë©”ëª¨ë¦¬ ê´€ë¦¬
```python
# ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì‹œ ì œë„ˆë ˆì´í„° í™œìš©
def process_large_dataset(self):
    """ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ë°ì´í„° ì²˜ë¦¬"""
    for chunk in self.read_data_in_chunks():
        yield self.process_chunk(chunk)
        # ë©”ëª¨ë¦¬ í•´ì œ
        del chunk
```

---

**ì´ì „ ë¬¸ì„œ**: [03_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md](./03_ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜.md)  
**ë‹¤ìŒ ë¬¸ì„œ**: [05_ë°°í¬_ê°€ì´ë“œ.md](./05_ë°°í¬_ê°€ì´ë“œ.md)