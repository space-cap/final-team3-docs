# 05. ë°°í¬ ê°€ì´ë“œ

## ğŸš€ ë°°í¬ í™˜ê²½ ê°œìš”

JOBER AIëŠ” ë‹¤ì–‘í•œ ë°°í¬ í™˜ê²½ì„ ì§€ì›í•©ë‹ˆë‹¤. ê° í™˜ê²½ë³„ ìµœì í™”ëœ ë°°í¬ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì§€ì› í™˜ê²½
- **ë¡œì»¬ ê°œë°œ**: ê°œë°œì ë¡œì»¬ ë¨¸ì‹ 
- **ìŠ¤í…Œì´ì§•**: í…ŒìŠ¤íŠ¸ í™˜ê²½  
- **í”„ë¡œë•ì…˜**: ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½
- **í´ë¼ìš°ë“œ**: AWS EC2, Google Cloud, Azure
- **ì»¨í…Œì´ë„ˆ**: Docker, Kubernetes

## ğŸ  ë¡œì»¬ ë°°í¬

### 1. ê¸°ë³¸ ì„¤ì •
```bash
# ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
git clone https://github.com/your-username/Jober_ai.git
cd Jober_ai

# Python í™˜ê²½ ì„¤ì • 
pyenv install 3.11.13
pyenv local 3.11.13

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# .env íŒŒì¼ ìƒì„±
cat > .env << EOF
GOOGLE_API_KEY=your_gemini_api_key
GEMINI_API_KEY=your_gemini_api_key
ENVIRONMENT=development
PORT=8000
HOST=127.0.0.1
EOF
```

### 3. ì„œë²„ ì‹¤í–‰
```bash
# ê°œë°œ ëª¨ë“œ
uvicorn server:app --reload --host 0.0.0.0 --port 8000

# ë˜ëŠ” Python ì§ì ‘ ì‹¤í–‰
python server.py
```

## â˜ï¸ í´ë¼ìš°ë“œ ë°°í¬

### AWS EC2 ë°°í¬

#### 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •
```bash
# Ubuntu 20.04 LTS ê¸°ì¤€
sudo apt update && sudo apt upgrade -y

# Python 3.11 ì„¤ì¹˜
sudo apt install software-properties-common -y
sudo add-apt-repository ppa:deadsnakes/ppa -y
sudo apt install python3.11 python3.11-venv python3.11-pip -y

# Git ì„¤ì¹˜
sudo apt install git -y
```

#### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
```bash
# ì‚¬ìš©ì ìƒì„±
sudo adduser jober-ai
sudo usermod -aG sudo jober-ai
su - jober-ai

# ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë¡ 
git clone https://github.com/your-username/Jober_ai.git
cd Jober_ai

# ê°€ìƒí™˜ê²½ ì„¤ì •
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

#### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# /home/jober-ai/Jober_ai/.env
cat > .env << EOF
GOOGLE_API_KEY=your_production_gemini_api_key
GEMINI_API_KEY=your_production_gemini_api_key
ENVIRONMENT=production
PORT=8000
HOST=0.0.0.0
EOF
```

#### 4. Systemd ì„œë¹„ìŠ¤ ì„¤ì •
```bash
# /etc/systemd/system/jober-ai.service
sudo tee /etc/systemd/system/jober-ai.service > /dev/null <<EOF
[Unit]
Description=JOBER AI Template Generator
After=network.target

[Service]
Type=exec
User=jober-ai
Group=jober-ai
WorkingDirectory=/home/jober-ai/Jober_ai
Environment=PATH=/home/jober-ai/Jober_ai/venv/bin
ExecStart=/home/jober-ai/Jober_ai/venv/bin/uvicorn server:app --host 0.0.0.0 --port 8000 --workers 4
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl daemon-reload
sudo systemctl enable jober-ai
sudo systemctl start jober-ai

# ìƒíƒœ í™•ì¸
sudo systemctl status jober-ai
```

#### 5. Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
```bash
# Nginx ì„¤ì¹˜
sudo apt install nginx -y

# ì„¤ì • íŒŒì¼ ìƒì„±
sudo tee /etc/nginx/sites-available/jober-ai > /dev/null <<EOF
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
EOF

# ì‚¬ì´íŠ¸ í™œì„±í™”
sudo ln -s /etc/nginx/sites-available/jober-ai /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### Google Cloud Platform ë°°í¬

#### 1. App Engine ë°°í¬
```yaml
# app.yaml
runtime: python311

env_variables:
  GOOGLE_API_KEY: "your_gemini_api_key"
  ENVIRONMENT: "production"

automatic_scaling:
  min_instances: 1
  max_instances: 10
  target_cpu_utilization: 0.6

resources:
  cpu: 1
  memory_gb: 2
```

```bash
# ë°°í¬ ëª…ë ¹
gcloud app deploy app.yaml

# ë°°í¬ í›„ URL í™•ì¸  
gcloud app browse
```

#### 2. Compute Engine ë°°í¬
```bash
# ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
gcloud compute instances create jober-ai-instance \
    --image-family=ubuntu-2004-lts \
    --image-project=ubuntu-os-cloud \
    --machine-type=e2-standard-2 \
    --zone=asia-northeast3-a

# SSH ì ‘ì† í›„ ìœ„ EC2 ë°°í¬ ë‹¨ê³„ ì§„í–‰
gcloud compute ssh jober-ai-instance
```

## ğŸ³ Docker ì»¨í…Œì´ë„ˆ ë°°í¬

### 1. Dockerfile ì‘ì„±
```dockerfile
# Dockerfile
FROM python:3.11.13-slim

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„± ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë³µì‚¬
COPY . .

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8000

# ë¹„root ì‚¬ìš©ì ìƒì„±
RUN adduser --disabled-password --gecos '' appuser
RUN chown -R appuser:appuser /app
USER appuser

# ì„œë²„ ì‹¤í–‰
CMD ["uvicorn", "server:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
```

### 2. Docker ë¹Œë“œ ë° ì‹¤í–‰
```bash
# ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t jober-ai:latest .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d \
    --name jober-ai-container \
    -p 8000:8000 \
    -e GOOGLE_API_KEY=your_api_key \
    -e ENVIRONMENT=production \
    --restart unless-stopped \
    jober-ai:latest

# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps
docker logs jober-ai-container
```

### 3. Docker Compose ì„¤ì •
```yaml
# docker-compose.yml
version: '3.8'

services:
  jober-ai:
    build: .
    ports:
      - "8000:8000"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ENVIRONMENT=production
    restart: unless-stopped
    volumes:
      - ./data:/app/data:ro
      - ./predata:/app/predata:ro
      - ./cache:/app/cache
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/nginx/ssl:ro
    depends_on:
      - jober-ai
    restart: unless-stopped
```

```bash
# Docker Compose ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f jober-ai
```

## â˜¸ï¸ Kubernetes ë°°í¬

### 1. ë°°í¬ ë§¤ë‹ˆí˜ìŠ¤íŠ¸
```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jober-ai
  labels:
    app: jober-ai
spec:
  replicas: 3
  selector:
    matchLabels:
      app: jober-ai
  template:
    metadata:
      labels:
        app: jober-ai
    spec:
      containers:
      - name: jober-ai
        image: jober-ai:latest
        ports:
        - containerPort: 8000
        env:
        - name: GOOGLE_API_KEY
          valueFrom:
            secretKeyRef:
              name: jober-ai-secrets
              key: google-api-key
        - name: ENVIRONMENT
          value: "production"
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"  
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 10

---
apiVersion: v1
kind: Service
metadata:
  name: jober-ai-service
spec:
  selector:
    app: jober-ai
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer

---
apiVersion: v1
kind: Secret
metadata:
  name: jober-ai-secrets
type: Opaque
stringData:
  google-api-key: "your_gemini_api_key"
```

### 2. Kubernetes ë°°í¬ ëª…ë ¹
```bash
# ì‹œí¬ë¦¿ ìƒì„± (API í‚¤)
kubectl create secret generic jober-ai-secrets \
    --from-literal=google-api-key=your_gemini_api_key

# ë°°í¬ ì‹¤í–‰
kubectl apply -f k8s-deployment.yaml

# ë°°í¬ ìƒíƒœ í™•ì¸
kubectl get pods -l app=jober-ai
kubectl get services

# ë¡œê·¸ í™•ì¸
kubectl logs -l app=jober-ai -f
```

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

### 1. HTTPS ì„¤ì •
```bash
# Let's Encrypt SSL ì¸ì¦ì„œ ì„¤ì¹˜
sudo apt install certbot python3-certbot-nginx -y

# SSL ì¸ì¦ì„œ ë°œê¸‰
sudo certbot --nginx -d your-domain.com

# ìë™ ê°±ì‹  ì„¤ì •
sudo crontab -e
# ë‹¤ìŒ ë¼ì¸ ì¶”ê°€: 0 12 * * * /usr/bin/certbot renew --quiet
```

### 2. ë°©í™”ë²½ ì„¤ì •
```bash
# UFW ë°©í™”ë²½ ì„¤ì •
sudo ufw enable
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw deny 8000/tcp  # ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨
```

### 3. í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ
```bash
# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod 600 .env
chown jober-ai:jober-ai .env

# ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš© (ê¶Œì¥)
echo 'export GOOGLE_API_KEY=your_key' >> /home/jober-ai/.bashrc
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ì„¤ì •

### 1. ë¡œê·¸ ì„¤ì •
```python
# í”„ë¡œë•ì…˜ ë¡œê¹… ì„¤ì •
import logging
from logging.handlers import RotatingFileHandler

if os.getenv("ENVIRONMENT") == "production":
    handler = RotatingFileHandler(
        '/var/log/jober-ai/app.log',
        maxBytes=10*1024*1024,  # 10MB
        backupCount=5
    )
    handler.setFormatter(logging.Formatter(
        '%(asctime)s %(levelname)s: %(message)s'
    ))
    logging.getLogger().addHandler(handler)
```

### 2. ìƒíƒœ ëª¨ë‹ˆí„°ë§
```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸
#!/bin/bash
# /home/jober-ai/monitor.sh

SERVICE_URL="http://localhost:8000/health"
ALERT_EMAIL="admin@your-domain.com"

if ! curl -f $SERVICE_URL > /dev/null 2>&1; then
    echo "JOBER AI service is down!" | mail -s "Service Alert" $ALERT_EMAIL
    sudo systemctl restart jober-ai
fi
```

```bash
# Cron ì‘ì—… ë“±ë¡
crontab -e
# */5 * * * * /home/jober-ai/monitor.sh
```

### 3. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
```python
# ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
import psutil
import time

def get_system_metrics():
    return {
        "cpu_percent": psutil.cpu_percent(interval=1),
        "memory_percent": psutil.virtual_memory().percent,
        "disk_usage": psutil.disk_usage('/').percent,
        "timestamp": time.time()
    }

# FastAPI ì—”ë“œí¬ì¸íŠ¸
@app.get("/metrics")
async def get_metrics():
    return get_system_metrics()
```

## ğŸ”„ ë°°í¬ ìë™í™”

### 1. GitHub Actions CI/CD
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.11.13'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: Run tests
      run: |
        python test_backend_integration.py
        
    - name: Deploy to server
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.PRIVATE_KEY }}
        script: |
          cd /home/jober-ai/Jober_ai
          git pull origin main
          source venv/bin/activate
          pip install -r requirements.txt
          sudo systemctl restart jober-ai
```

### 2. ë¸”ë£¨-ê·¸ë¦° ë°°í¬
```bash
#!/bin/bash
# blue_green_deploy.sh

CURRENT_COLOR=$(docker ps --format "table {{.Names}}" | grep jober-ai | grep -o "blue\|green")
NEW_COLOR="blue"
if [ "$CURRENT_COLOR" == "blue" ]; then
    NEW_COLOR="green"
fi

echo "Current: $CURRENT_COLOR, Deploying: $NEW_COLOR"

# ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘
docker run -d \
    --name jober-ai-$NEW_COLOR \
    -p 800$([[ $NEW_COLOR == "blue" ]] && echo 1 || echo 2):8000 \
    jober-ai:latest

# í—¬ìŠ¤ ì²´í¬
sleep 10
if curl -f http://localhost:800$([[ $NEW_COLOR == "blue" ]] && echo 1 || echo 2)/health; then
    # ë¡œë“œ ë°¸ëŸ°ì„œ íŠ¸ë˜í”½ ì „í™˜
    echo "Switching traffic to $NEW_COLOR"
    # ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì œê±°
    docker stop jober-ai-$CURRENT_COLOR
    docker rm jober-ai-$CURRENT_COLOR
else
    echo "Deploy failed, rolling back"
    docker stop jober-ai-$NEW_COLOR
    docker rm jober-ai-$NEW_COLOR
    exit 1
fi
```

---

**ì´ì „ ë¬¸ì„œ**: [04_ê°œë°œ_ê°€ì´ë“œ.md](./04_ê°œë°œ_ê°€ì´ë“œ.md)  
**ë‹¤ìŒ ë¬¸ì„œ**: [06_ë¬¸ì œí•´ê²°_ê°€ì´ë“œ.md](./06_ë¬¸ì œí•´ê²°_ê°€ì´ë“œ.md)